<!DOCTYPE html>
<html>
<head>
  <title>SecurityLab Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>ESP32 Security Lab</h2>
      <nav>
        <a href="/">Dashboard</a>
        <a href="/manual">Manual</a>
        <a href="/eventlog">Export</a>
        <a href="/logout">Logout</a>
      </nav>
    </div>
    <section>
      <h4>WiFi Scanner</h4>
      <button id="scanBtn">Scan</button>
      <table id="netlist"></table>
    </section>
    <section>
      <h4>Deauth Attack</h4>
      <select id="targetList"></select>
      <input id="pkCount" type="number" value="100" min="1" max="10000">
      <button id="deauthBtn">Start</button>
    </section>
    <section>
      <h4>Consent Popup Test</h4>
      <button id="consentPop">Show Consent</button>
    </section>
    <section>
      <h4>Logs/Export</h4>
      <button id="getLogs">Download</button>
      <textarea id="logs" rows="8" style="width:100%"></textarea>
    </section>
    <section>
      <h4>Manual</h4>
      <a href="/manual">Read Feature Guides</a>
    </section>
  </div>
  <script>
    function loadScan() {
      fetch('/scan').then(r=>r.json()).then(list=>{
        let tbl = "<tr><th>SSID</th><th>RSSI</th><th>Chan</th><th>Enc</th><th>BSSID</th></tr>";
        list.forEach(ap=>{
          tbl += `<tr onclick="setTarget('${ap.bssid}','${ap.ssid}')">
            <td>${ap.ssid}</td><td>${ap.rssi}</td><td>${ap.chan}</td><td>${ap.enc}</td><td>${ap.bssid}</td></tr>`;
        });
        document.getElementById('netlist').innerHTML = tbl;
        let tgt = document.getElementById('targetList');
        tgt.innerHTML = '';
        list.forEach(ap => tgt.innerHTML += `<option value="${ap.bssid}">${ap.ssid} (${ap.bssid})</option>`);
      });
    }
    function setTarget(bssid, ssid) {
      document.getElementById('targetList').value = bssid;
    }
    document.getElementById('scanBtn').onclick = loadScan;
    document.getElementById('deauthBtn').onclick = () => {
      let bssid = document.getElementById('targetList').value;
      let cnt = document.getElementById('pkCount').value;
      fetch('/deauth', {method:'POST',body:new URLSearchParams({bssid,cnt})})
      .then(r=>r.text()).then(t=>alert(t));
    };
    document.getElementById('consentPop').onclick = () => {
      let device="customtest", agree="yes";
      fetch('/consent',{method:'POST',body:new URLSearchParams({device,agree})})
      .then(r=>r.text()).then(t=>alert(t));
    }
    document.getElementById('getLogs').onclick = () => {
      fetch('/eventlog').then(r=>r.text()).then(t=>document.getElementById('logs').value=t);
    };
  </script>
</body>
</html>